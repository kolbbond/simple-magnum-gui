get_filename_component(smg_CMAKE_DIR "${CMAKE_CURRENT_LIST_FILE}" PATH)
include(CMakeFindDependencyMacro)

message(STATUS "SMG CONFIG")

# add path
list(APPEND CMAKE_MODULE_PATH ${smg_CMAKE_DIR})
list(REMOVE_AT CMAKE_MODULE_PATH -1)

# SDL (should be included through magnum)
if(OFF)
find_dependency(SDL2)
if(NOT TARGET SDL2)
    message(STATUS "SDL2 is not target")
endif()

# OpenGL
if(NOT TARGET OpenGL)
    message(STATUS "OpenGL is not target")
  set(OpenGL_GL_PREFERENCE "GLVND")
find_dependency(OpenGL)
endif()

endif()

# MagnumIntegration
if(NOT TARGET MagnumIntegration)
    message(STATUS "MagnumIntegration is not target")
    find_dependency(MagnumIntegration)
    find_dependency(MagnumIntegration REQUIRED ImGui)
endif()

# Corrade
if(NOT TARGET Corrade)
    message(STATUS "Corrade is not target")
    find_dependency(Corrade)
    find_dependency(Corrade REQUIRED Main)
endif()

# Magnum
if(NOT TARGET Magnum)
    message(STATUS "Magnum is not target")
    find_dependency(Magnum REQUIRED 
        GL
        MeshTools
        Primitives
        Shaders
        Trade
        Sdl2Application
)
endif()

# armadillo 
find_dependency(Armadillo CONFIG REQUIRED)
if(NOT TARGET Arma::Armadillo)
	add_library(Arma::Armadillo INTERFACE IMPORTED)
	set_target_properties(Arma::Armadillo PROPERTIES
		INTERFACE_INCLUDE_DIRECTORIES "${ARMADILLO_INCLUDE_DIRS}"
		INTERFACE_LINK_LIBRARIES "${ARMADILLO_LIBRARY}")

	# disable opernmp acceleration
	# target_compile_definitions(Arma::Armadillo INTERFACE -DARMA_DONT_USE_OPENMP)

	# set (n)debug flags for Armadilo
	if(CMAKE_BUILD_TYPE STREQUAL Release)
		message(STATUS "Using Armadillo no-debug flags (conformance check disabled!)")
		target_compile_definitions(Arma::Armadillo INTERFACE -DNDEBUG -DARMA_NO_DEBUG -DARMA_DONT_CHECK_CONFORMANCE -DARMA_WARN_LEVEL=1)
	else()
		message(STATUS "Using Armadillo in debug mode")
	endif()

	# disable armadillo wrapper (for using custom BLAS)
	if(BLAS_FOUND AND LAPACK_FOUND)
		# report to user
		message(STATUS "Disabling Armadillo BLAS wrapper.")
		target_compile_definitions(Arma::Armadillo INTERFACE -DARMA_DONT_USE_WRAPPER -DARMA_USE_BLAS)
	endif()

	# disable superlu if not available
    #find_dependency(superlu)
    #set(ENABLE_SUPERLU ON)
    if(NOT SUPERLU_FOUND)
		message(STATUS "Disabling Armadillo SuperLU")
        target_compile_definitions(Arma::Armadillo INTERFACE -DARMA_DONT_USE_SUPERLU)
    endif()
endif()

# find implot?
#if(NOT TARGET ImPlot)
#message(STATUS "ImPlot not target, find dependency")
#find_dependency(ImPlot)
#endif()

# if we are not smg include smg!
if(NOT TARGET smg)
    message(STATUS "smg is not target")
    message(STATUS "ADD SMG TARGETS")

    # include definitions
    include("${smg_CMAKE_DIR}/smgTargets.cmake")

endif()
set(smg_LIBRARIES smg)

